syntax = "proto3";

package tkd.idm.v1;

import "buf/validate/validate.proto";
import "tkd/idm/v1/user.proto";
import "google/protobuf/field_mask.proto";

service SelfServiceService {
    rpc ChangePassword (ChangePasswordRequest) returns (ChangePasswordResponse) {}
    rpc ValidateEmail (ValidateEmailRequest) returns (ValidateEmailResponse) {}
    rpc UpdateProfile (UpdateProfileRequest) returns (UpdateProfileResponse) {}
    rpc AddEmailAddress (AddEmailAddressRequest) returns (AddEmailAddressResponse) {}
    rpc DeleteEmailAddress (DeleteEmailAddressRequest) returns (DeleteEmailAddressResponse) {}
    rpc AddAddress (AddAddressRequest) returns (AddAddressResponse) {}
    rpc DeleteAddress (DeleteAddressRequest) returns (DeleteAddressResponse) {}
    rpc UpdateAddress (UpdateAddressRequest) returns (UpdateAddressResponse) {}
}

message ChangePasswordRequest {
    string old_password = 1 [
        (buf.validate.field).string.min_len = 1
    ];

    string new_password = 2 [
        (buf.validate.field).string.min_len = 4
    ];
}
message ChangePasswordResponse {}

message UpdateProfileRequest {
    User user = 1;
    google.protobuf.FieldMask field_mask = 2;
}

message UpdateProfileResponse {
    User user = 1;
}

message ValidateEmailRequest {}
message ValidateEmailResponse {}

message AddEmailAddressRequest {
    string email = 1 [
        (buf.validate.field).string.email = true
    ];
}

message AddEmailAddressResponse {
    repeated EMail emails = 1;
}

message DeleteEmailAddressRequest {
    string id = 1;
}

message DeleteEmailAddressResponse {
    repeated EMail emails = 1;
}

message AddAddressRequest {}
message AddAddressResponse {}
message UpdateAddressRequest {}
message UpdateAddressResponse {}
message DeleteAddressRequest {}
message DeleteAddressResponse {}