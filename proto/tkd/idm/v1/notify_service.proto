syntax = "proto3";

package tkd.idm.v1;

import "buf/validate/validate.proto";
import "google/protobuf/struct.proto";

// Admin API only
//
service NotifyService {
    rpc SendNotification(SendNotificationRequest) returns (SendNotificationResponse) {}
}

message Attachment {
    string name = 1;
    string media_type = 2;
    bytes content = 3;
}

message EMailMessage {
    string subject = 1 [
        (buf.validate.field).required = true
    ];

    string body = 2 [
        (buf.validate.field).required = true
    ];

    google.protobuf.Struct template_context = 3;

    repeated Attachment attachments = 4;
}

message SMS {
    string body = 1;
    google.protobuf.Struct template_context = 2;
}

message SendNotificationRequest {
    oneof message {
        SMS sms = 1;
        EMailMessage email = 2;

        option (buf.validate.oneof).required = true;
    };

    repeated string target_users = 3;
    repeated string target_roles = 4;
}

message DeliveryNotification {
    string target_user = 1;
    string error = 2;
}

message SendNotificationResponse {
    repeated DeliveryNotification deliveries = 1;
}

