syntax = "proto3";

package tkd.idm.v1;

import "google/protobuf/struct.proto";
import "buf/validate/validate.proto";
import "tkd/idm/v1/descriptor.proto";

message EMail {
  string address = 1 [(buf.validate.field).string.email = true];

  bool verified = 2;
}

message Address {
  string city_code = 1 [(buf.validate.field).string = {
    pattern: "[0-9]+",
    max_bytes: 16
  }];

  string city_name = 2 [(buf.validate.field).string.min_len = 1];

  string street = 3 [(buf.validate.field).string.min_len = 1];

  string extra = 4;
}

message User {
  string id = 1;

  string username = 2 [
    (buf.validate.field).string.min_len = 3
  ];

  string display_name = 3 [
    (buf.validate.field).string.min_len = 3,
    (tkd.idm.v1.allow_self_service) = true
  ];

  string first_name = 4 [
    (tkd.idm.v1.allow_self_service) = true
  ];
  string last_name = 5 [
    (tkd.idm.v1.allow_self_service) = true
  ];

  repeated Address addresses = 6 [
    (tkd.idm.v1.allow_self_service) = true
  ];

  repeated string phone_numbers = 7 [
    (tkd.idm.v1.allow_self_service) = true
  ];

  repeated EMail email_addresses = 8 [
    (tkd.idm.v1.allow_self_service) = true
  ];

  map<string, google.protobuf.Value> extra = 9;

  string avatar = 10 [
    (tkd.idm.v1.allow_self_service) = true
  ];
}
